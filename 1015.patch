From 3f436f3e4e1b913816fc7a26c3399a2e0eec923c Mon Sep 17 00:00:00 2001
From: Nolan Woods <nolan_w@sfu.ca>
Date: Thu, 27 May 2021 18:16:24 -0700
Subject: [PATCH] Make plugin path configurable

---
 .../irida/config/services/IridaPluginConfig.java           | 7 ++++---
 .../bioinformatics/irida/config/filesystem.properties      | 1 +
 5 files changed, 8 insertions(+), 3 deletions(-)

diff --git a/src/main/java/ca/corefacility/bioinformatics/irida/config/services/IridaPluginConfig.java b/src/main/java/ca/corefacility/bioinformatics/irida/config/services/IridaPluginConfig.java
index cb0950986d..f94001a1ea 100644
--- a/src/main/java/ca/corefacility/bioinformatics/irida/config/services/IridaPluginConfig.java
+++ b/src/main/java/ca/corefacility/bioinformatics/irida/config/services/IridaPluginConfig.java
@@ -1,12 +1,12 @@
 package ca.corefacility.bioinformatics.irida.config.services;
 
-import java.nio.file.Path;
 import java.nio.file.Paths;
 import java.util.List;
 
 import org.pf4j.DefaultPluginManager;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;
+import org.springframework.beans.factory.annotation.Value;
 import org.springframework.context.annotation.Bean;
 import org.springframework.context.annotation.Configuration;
 
@@ -23,7 +23,8 @@
 
 	private static final Logger logger = LoggerFactory.getLogger(IridaPluginConfig.class);
 
-	private static final Path PIPELINE_PLUGIN_PATH = Paths.get("/etc/irida/plugins");
+	@Value("${pipeline.plugin.path}")
+	String pipelinePluginPath;
 
 	/**
 	 * Get the list of IRIDA pipeline plugins
@@ -33,7 +34,7 @@
 	 */
 	@Bean(name = "iridaPipelinePlugins")
 	public IridaPluginList iridaPipelinePlugins() {
-		DefaultPluginManager pluginManager = new DefaultPluginManager(PIPELINE_PLUGIN_PATH);
+		DefaultPluginManager pluginManager = new DefaultPluginManager(Paths.get(pipelinePluginPath));
 		pluginManager.setSystemVersion(IridaPlugin.PLUGIN_API_VERSION);
 		pluginManager.setExactVersionAllowed(true);
 
diff --git a/src/main/resources/ca/corefacility/bioinformatics/irida/config/filesystem.properties b/src/main/resources/ca/corefacility/bioinformatics/irida/config/filesystem.properties
index a2036e1082..30f0cb86e9 100644
--- a/src/main/resources/ca/corefacility/bioinformatics/irida/config/filesystem.properties
+++ b/src/main/resources/ca/corefacility/bioinformatics/irida/config/filesystem.properties
@@ -2,6 +2,7 @@ sequence.file.base.directory=/tmp/irida/sequence-files
 reference.file.base.directory=/tmp/irida/reference-files
 output.file.base.directory=/tmp/irida/output-files
 assembly.file.base.directory=/tmp/irida/assembly-files
+pipeline.plugin.path=/etc/irida/plugins
 
 file.processing.decompress=true
 file.processing.decompress.remove.compressed.file=false
